<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Büro - Mydlak Architektur</title>
    <meta name="description" content="Mydlak Architektur - Büro und Projekte">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://umami-ten-liart.vercel.app/script.js"
        data-website-id="863abb7a-77c4-4a76-b779-dff207e1e91d"></script>
</head>

<body>
    <nav class="main-nav">
        <div class="nav-content">
            <a href="/" class="nav-logo">Mydlak Architektur</a>
            <ul class="nav-menu">
                <li><a href="/buero/" class="active">Büro</a></li>
                <li><a href="#" id="kontakt-btn">Kontakt</a></li>
            </ul>
        </div>
    </nav>

    <!-- Contact Side Panel -->
    <div class="contact-overlay" id="contact-overlay"></div>
    <div class="contact-panel" id="contact-panel">
        <button class="close-btn" id="close-btn">&times;</button>
        <div class="contact-panel-content" id="contact-content">
            <h2>Kontakt</h2>
            <div class="contact-info-simple">
                <p>Justyna Mydlak<br>
                    MSc Architektin USI AAM<br>
                    Mydlak Architektur GmbH<br>
                    Via Prau da Cuort 6<br>
                    7153 Falera</p>
                <a href="mailto:justyna@mydlak.ch">Email</a>
            </div>
        </div>
    </div>

    <div class="container">
        <main class="buero-page">
            <div class="accordion-section">
                <button class="accordion-btn" data-target="profil">
                    <span class="accordion-icon">+</span>
                    <span class="accordion-title">Profil</span>
                </button>
                <div class="accordion-content" id="profil">
                    <div class="profile-content" id="profile-content">
                        <h3><a href="mailto:justyna@mydlak.ch" class="profile-name-link">Justyna Mydlak</a></h3>
                        <p class="profile-subtitle">MSc Architektin USI AAM</p>
                        <p class="profile-bio">
                            Studium der Architektur und des Städtebaus an der Gdańsk University of Technology
                            (2011–2015). 2016–2018 Masterstudium der Architektur an der Accademia di architettura,
                            Università della Svizzera italiana in Mendrisio. 2015–2016 Tätigkeit bei Bjarke Ingels Group
                            (BIG) in New York, 2016 bei BIG in Kopenhagen. 2018–2021 Architektin bei Mathis Kamplade
                            Architekten, 2021–2023 bei Büro Krucker Architekten, seit 2023 bei spillmann echsle
                            architekten ag, seit 2024 als Project Lead. Seit 2023 selbständig tätig, 2025 Gründung der
                            Mydlak Architektur GmbH.
                        </p>
                    </div>
                </div>
            </div>

            <div class="accordion-section">
                <button class="accordion-btn" data-target="taetigkeit">
                    <span class="accordion-icon">+</span>
                    <span class="accordion-title">Tätigkeit</span>
                </button>
                <div class="accordion-content" id="taetigkeit">
                    <div class="jobs-content">
                        <p>Wir entwickeln massgeschneiderte Architekturlösungen – vom ersten Entwurf über die
                            detaillierte Planung bis zur erfolgreichen Projektumsetzung. Mit langjähriger Erfahrung
                            begleiten wir Sie durch den gesamten Prozess und setzen Ihre Vision in Realität um.</p>
                        <p></p>
                    </div>
                </div>
            </div>

            <div class="accordion-section">
                <button class="accordion-btn" data-target="jobs">
                    <span class="accordion-icon">+</span>
                    <span class="accordion-title">Jobs</span>
                </button>
                <div class="accordion-content" id="jobs">
                    <div class="jobs-content" id="jobs-container">
                        <p>Aktuell haben wir keine offenen Stellen ausgeschrieben.
                            Wir freuen uns jedoch über Initiativbewerbungen von engagierten
                            Architekt:innen, die unsere Leidenschaft für durchdachte Gestaltung teilen.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-section">
                <button class="accordion-btn" id="home-btn">
                    <span class="accordion-icon">+</span>
                    <span class="accordion-title">Home</span>
                </button>
            </div>
        </main>

        <footer class="footer-extended">
            <div class="footer-links">
                <a href="/impressum/">Impressum</a>
                <a href="/datenschutz/">Datenschutz</a>
            </div>
        </footer>
    </div>

    <script>
        // Scroll to top if coming from legal page back button
        if (sessionStorage.getItem('scrollToTop') === 'true') {
            window.scrollTo(0, 0);
            sessionStorage.removeItem('scrollToTop');
        }

        // Event tracking via virtual pageviews
        function trackEvent(eventName) {
            try {
                if (typeof __cfBeacon !== 'undefined' && __cfBeacon.load) {
                    __cfBeacon.load('pageview', {
                        virtualPage: '/event/' + eventName
                    });
                }
            } catch (e) {
                // Silently fail if tracking is not available
                console.log('Tracking not available:', e);
            }
        }

        // Contact Panel Toggle
        const kontaktBtn = document.getElementById('kontakt-btn');
        const closeBtn = document.getElementById('close-btn');
        const contactPanel = document.getElementById('contact-panel');
        const contactOverlay = document.getElementById('contact-overlay');

        kontaktBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (typeof umami !== 'undefined') umami.track('kontakt-opened');
            trackEvent('kontakt-opened-from-buero');
            contactPanel.classList.add('active');
            contactOverlay.classList.add('active');
        });

        closeBtn.addEventListener('click', () => {
            contactPanel.classList.remove('active');
            contactOverlay.classList.remove('active');
        });

        contactOverlay.addEventListener('click', () => {
            contactPanel.classList.remove('active');
            contactOverlay.classList.remove('active');
        });

        // Pocketbase helpers & rendering (profile + contact)
        const PB_BASE = 'https://mydlak-pocketbase.fly.dev';

        async function fetchCollectionFirst(collection) {
            const url = `${PB_BASE}/api/collections/${collection}/records?perPage=1`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Failed to fetch ${collection}`);
            const data = await res.json();
            return (data && Array.isArray(data.items) && data.items.length) ? data.items[0] : null;
        }

        async function fetchAllRecords(collection) {
            const url = `${PB_BASE}/api/collections/${collection}/records?sort=-updated`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Failed to fetch ${collection}`);
            const data = await res.json();
            return (data && Array.isArray(data.items)) ? data.items : [];
        }

        // Profile
        (function initProfile() {
            const el = document.getElementById('profile-content');
            if (!el) return;

            fetchCollectionFirst('profile')
                .then(rec => {
                    if (!rec) return;
                    if (rec.html) {
                        el.innerHTML = rec.html;
                        return;
                    }

                    const name = rec.name || 'Justyna Mydlak';
                    const title = rec.title || 'MSc Architektin USI AAM';
                    const bio = rec.bio || '';
                    const email = rec.email || 'justyna@mydlak.ch';

                    // file fields in Pocketbase are arrays of filenames under record[field]
                    const fileField = rec.image || rec.avatar || rec.photo || null;
                    let imageHtml = '';
                    if (fileField && Array.isArray(fileField) && fileField.length > 0) {
                        const filename = fileField[0];
                        const imageUrl = `${PB_BASE}/api/files/profile/${rec.id}/image/${encodeURIComponent(filename)}`;
                        imageHtml = `
                        <div class="profile-image-wrap">
                            <img class="profile-image" src="${imageUrl}" alt="${name}">
                        </div>`;
                    }

                    el.innerHTML = `${imageHtml}
                        <h3><a href="mailto:${email}" class="profile-name-link">${name}</a></h3>
                        <p class="profile-subtitle">${title}</p>
                        <p class="profile-bio">${bio}</p>`;
                })
                .catch(err => {
                    console.log('profile load error', err);
                });
        })();

        // Contact (update from Pocketbase if available)
        (function initContact() {
            const el = document.getElementById('contact-content');
            if (!el) return;

            fetchCollectionFirst('contact')
                .then(rec => {
                    if (!rec) return;
                    if (rec.html) {
                        el.innerHTML = rec.html;
                        return;
                    }
                    const name = rec.name || 'Justyna Mydlak';
                    const title = rec.title || 'MSc Architektin USI AAM';
                    const company = rec.company || 'Mydlak Architektur GmbH';
                    const address = rec.address || 'Via Prau da Cuort 6<br>7153 Falera';
                    const email = rec.email || 'justyna@mydlak.ch';
                    el.innerHTML = `
                        <h2>Kontakt</h2>
                        <div class="contact-info-simple">
                            <p>${name}<br>${title}<br>${company}<br>${address}</p>
                            <a href="mailto:${email}">Email</a>
                        </div>`;
                })
                .catch(err => {
                    console.log('contact load error', err);
                });
        })();

        // Jobs
        (function initJobs() {
            const el = document.getElementById('jobs-container');
            if (!el) return;

            fetchAllRecords('jobs')
                .then(items => {
                    const activeJobs = items.filter(j => j.active !== false);
                    if (activeJobs.length === 0) return;

                    const plural = activeJobs.length > 1;
                    let html = `<p class="jobs-intro">Wir suchen aktuell Verstärkung für folgende ${plural ? 'Positionen' : 'Position'}:</p>`;

                    activeJobs.forEach(job => {
                        const title = job.title || 'Architekt:in';
                        const desc = job.description || '';
                        const email = job.email || 'justyna@mydlak.ch';
                        const subject = encodeURIComponent(`Bewerbung: ${title}`);

                        let fileLink = '';
                        if (job.pdf) {
                            const fileUrl = `${PB_BASE}/api/files/jobs/${job.id}/${job.pdf}`;
                            fileLink = `<a href="${fileUrl}" target="_blank" class="job-pdf-link">Inserat (PDF) <span>↓</span></a>`;
                        }

                        html += `
                            <div class="job-item">
                                <h4 class="job-title">${title}</h4>
                                <div class="job-description">${desc}</div>
                                <div class="job-actions">
                                    ${fileLink}
                                    <a href="mailto:${email}?subject=${subject}" class="job-apply-link">Bewerben <span>↗</span></a>
                                </div>
                            </div>`;
                    });
                    html += `
                        <div class="jobs-footer">
                            <p>Wir freuen uns auch jederzeit über Initiativbewerbungen von engagierten Architekt:innen, die unsere Leidenschaft für durchdachte Gestaltung teilen.</p>
                        </div>`;
                    el.innerHTML = html;
                })
                .catch(err => {
                    console.log('jobs load error', err);
                });
        })();

        // Accordion Toggle
        const accordionBtns = document.querySelectorAll('.accordion-btn');

        accordionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-target');
                if (!targetId) return; // Skip if no target (e.g. Home button)

                const content = document.getElementById(targetId);
                const isActive = content.classList.contains('active');

                // Track accordion interaction
                const accordionName = targetId.replace('-content', '');
                const action = isActive ? 'closed' : 'opened';
                trackEvent('accordion-' + accordionName + '-' + action);

                if (isActive) {
                    content.classList.remove('active');
                    btn.setAttribute('aria-expanded', 'false');
                } else {
                    content.classList.add('active');
                    btn.setAttribute('aria-expanded', 'true');
                }
            });
        });

        // Home Button - Smooth slide-out transition
        const homeBtn = document.getElementById('home-btn');
        homeBtn.addEventListener('click', () => {
            trackEvent('home-clicked-from-buero');
            document.body.classList.add('page-exit');
            setTimeout(() => {
                window.location.href = '/';
            }, 500);
        });
    </script>

    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "25c2069b2f03483c8a41850f2fc04774"}'></script>
    <!-- End Cloudflare Web Analytics -->
</body>

</html>